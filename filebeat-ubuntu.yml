filebeat.inputs:
# Docker container logları
- type: log
  enabled: true
  paths:
    - '/var/lib/docker/containers/*/*-json.log'
    - '/var/lib/docker/containers/*/*.log'
    - '/mnt/data-storage/docker/containers/*/*-json.log'
    - '/mnt/data-storage/docker/containers/*/*.log'
  fields:
    log_source: "docker_container"
    log_type: "container"
  fields_under_root: true
  processors:
    - add_docker_metadata: ~
    - decode_json_fields:
        fields: ["log"]
        target: ""
        overwrite_keys: true
        add_error_key: true

# Sistem logları (Ubuntu)
- type: log
  enabled: true
  paths:
    - /var/log/syslog
    - /var/log/auth.log
    - /var/log/kern.log
  fields:
    log_type: "system"
    log_source: "system"
  fields_under_root: true

# Application logları
- type: log
  enabled: true
  paths:
    - /var/log/*.log
    - /var/log/*/*.log
  fields:
    log_type: "application"
    log_source: "application"
  fields_under_root: true

processors:
- add_host_metadata:
    when.not.contains.tags: forwarded
- add_cloud_metadata: ~
- add_fields:
    fields:
      source: "docker_logs"
      environment: "production"
      timezone: "Europe/Berlin"
- drop_fields:
    fields: ["log.offset", "log.file.path"]

output.elasticsearch:
  hosts: ["elasticsearch.emm-cyber.de:443"]
  username: "elastic"
  password: "ElasticPass123!"
  index: "docker-logs-%{+yyyy.MM.dd}"
  
  # HTTPS kullanıyoruz
  protocol: "https"
  ssl.verification_mode: "none"  # Self-signed sertifika için

setup.template.name: "docker-logs"
setup.template.pattern: "docker-logs-*"

setup.kibana:
  host: "kibana.emm-cyber.de:443"
  username: "kibana_user"
  password: "KibanaPass123!"
  
  # HTTPS kullanıyoruz
  protocol: "https"
  ssl.verification_mode: "none"  # Self-signed sertifika için

# Timezone ayarı
setup.template.settings:
  index.number_of_shards: 1
  index.number_of_replicas: 0

# Global timezone ayarı
setup.kibana.timezone: "Europe/Berlin"

logging.level: info
logging.to_files: true
logging.files:
  path: /usr/share/filebeat/logs
  name: filebeat
  keepfiles: 7
  permissions: 0644 